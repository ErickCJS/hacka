{% extends "partials/sidebar.html" %}
{% block title %} Asignación de Cámaras {% endblock %}
{% block content %}

<!-- Estilos y librerías adicionales -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="/static/css/gestion_camaras.css">

<!-- Mapbox -->
<link href="https://api.mapbox.com/mapbox-gl-js/v3.17.0-beta.1/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.17.0-beta.1/mapbox-gl.js"></script>

<div class="container-fluid g-0 min-vh-100 min-vw-100 row">

    <!-- SIDEBAR BÚSQUEDA -->
    <div class="col-2 ms-3 me-3">
        <div class="div_buscar">
            <label for="buscar">Cámara:</label>
            <div class="in_buscar">
                <i class="bi bi-search ms-2 me-2"></i>
                <input type="text" id="buscar" name="buscar" placeholder="Ingresa el nombre de la cámara o ubicación">
            </div>
        </div>

        <div class="lista_camaras mt-2 overflow-y-scroll">
            {% for camara in camaras %}
                <div class="card shadow-sm mb-2 border-0">
                    <div class="card-body p-3">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-camera-video me-2 text-primary fs-5"></i>
                            <label class="n_camar fw-bold mb-0 flex-grow-1">
                                {{ camara.nombre_camara }}
                            </label>
                            <span class="badge {{ 'bg-primary' if camara.estado == 'A' else 'bg-danger' }}">
                                {{ 'Activo' if camara.estado == 'A' else 'Inactivo' }}
                            </span>
                        </div>

                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-pin-map me-2 text-danger fs-5"></i>
                            <label class="n_call mb-0 text-muted small">{{ camara.calle }}</label>
                        </div>

                        <button class="btn btn-sm btn-outline-primary w-100 mt-2"
                                onclick="seleccionar_camara({{ camara.longitud }}, {{ camara.latitud }})">
                            <i class="bi bi-eye me-1"></i> Ubicar cámara
                        </button>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- MAPA -->
    <div class="col-9">
        <h3>Panel de monitoreo de seguridad</h3>
        <div id="map"></div>
    </div>

    <!-- MODAL -->
    <div class="modal fade" id="modalCamara" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title d-flex align-items-center gap-2">
                        <i class="bi bi-camera-video-fill text-secondary"></i>
                        <span id="titl_md">Registrar cámara</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <form id="formCamara">

                        <div class="mb-3">
                            <label class="form-label d-flex align-items-center gap-2">
                                <i class="bi bi-type"></i> Id cámara
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-camera-video-fill text-secondary"></i>
                                </span>
                                <input type="text" class="form-control" id="camiId" placeholder="CM-01">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label d-flex align-items-center gap-2">
                                <i class="bi bi-type"></i> Nombre de la cámara
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-camera-fill text-secondary"></i>
                                </span>
                                <input type="text" class="form-control" id="camNombre" placeholder="Ej. Cámara Plaza">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label d-flex align-items-center gap-2">
                                <i class="bi bi-link-45deg"></i> URL de la cámara (RTSP / HTTP)
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-wifi text-secondary"></i>
                                </span>
                                <input type="text" class="form-control" id="camUrl" placeholder="rtsp://...">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col">
                                <label class="form-label d-flex align-items-center gap-2">
                                    <i class="bi bi-geo-alt text-secondary"></i> Latitud
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-arrow-up"></i></span>
                                    <input type="text" readonly class="form-control" id="camLat" disabled>
                                </div>
                            </div>

                            <div class="col">
                                <label class="form-label d-flex align-items-center gap-2">
                                    <i class="bi bi-geo text-secondary"></i> Longitud
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-arrow-right"></i></span>
                                    <input type="text" readonly class="form-control" id="camLng" disabled>
                                </div>
                            </div>
                        </div>

                        <div class="mt-3">
                            <label class="form-label d-flex align-items-center gap-2">
                                <i class="bi bi-signpost text-secondary"></i> Calle
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-signpost-split-fill"></i>
                                </span>
                                <input type="text" readonly class="form-control" id="nomCalle" disabled>
                            </div>
                        </div>

                        <div class="mt-3">
                            <label class="form-label d-flex align-items-center gap-2">
                                <i class="bi bi-stop text-secondary"></i> Estado
                            </label>
                            <div class="d-flex gap-3 align-items-center">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="estado_cam" id="estado_activo" value="Activo" checked>
                                    <label class="form-check-label" for="estado_activo">Activo</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="estado_cam" id="estado_inactivo" value="Inactivo">
                                    <label class="form-check-label" for="estado_inactivo">Inactivo</label>
                                </div>
                            </div>
                        </div>

                    </form>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-primary w-100" id="guardarCamara">
                        <i class="bi bi-check-circle-fill me-1"></i>
                        <span id="btn_txt">Guardar</span>
                    </button>
                </div>

            </div>
        </div>
    </div>

</div>

<script>
    const camaras = {{ camaras | tojson | safe }};
</script>
<script src="/static/js/camaras.js"></script>

{% endblock %}
